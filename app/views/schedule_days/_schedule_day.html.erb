<div class="tab-pane <%= schedule_day.index == 1 && 'active' %>" id="day<%= schedule_day.index %>">
  <div class="schedule-form">

    <div class="schedule-content" style="margin-top: 24px">
      <div id="schedule_<%= schedule_day.index %>" class="schedule">
        <ul class="sortable" id="sortable_<%= schedule_day.index %>">
          <%= render schedule_day.attractions %>
        </ul>

        <%= form_tag schedule_day_attractions_path(schedule_day), remote: true, method: :post,
                     class: 'form-horizontal form-schedule form-card',
                     id: "form-schedule_#{schedule_day.index}" do %>

            <!-- Place to go to -->
            <div class="form-group">
              <label for="attraction_<%= schedule_day.index %>" class="control-label">
                Tourist Attraction:
              </label>
              <input class="typeahead form-control" type="text" placeholder="Where you love to visit"
                     id="attraction_<%= schedule_day.index %>">
              <input type="hidden" name="attraction[place_id]" id="place_<%= schedule_day.index %>" value="">
            </div>

            <!-- Spending hours -->
            <div class="form-group">
              <label for="spendingTime_<%= schedule_day.index %>" class="control-label">
                Hours spending:
              </label>
              <select class="form-control" name="attraction[hour_spend]" id="spendingTime_<%= schedule_day.index %>">
                <option>1</option>
                <option>2</option>
                <option>3</option>
                <option>4</option>
                <option>5</option>
              </select>
            </div>

            <!-- Submit button -->
            <div class="form-group">
              <button type="submit" class="btn addItineraryBtn">Add to itinerary</button>
            </div>
        <% end %>


      </div>

    </div>
  </div>
</div>

<script>
  // Typehead
  var placeIds = <%= raw @place_ids.to_json %>;
  var placeNames = <%= raw @place_names.to_json %>;
  var states = new Bloodhound({
    datumTokenizer: Bloodhound.tokenizers.whitespace,
    queryTokenizer: Bloodhound.tokenizers.whitespace,
    local: placeNames
  });
  $('#attraction_<%= schedule_day.index %>').bind('typeahead:select', function (ev, suggestion) {
    $("#place_<%= schedule_day.index %>").val(placeIds[placeNames.indexOf(suggestion)]);
  });

  $('#attraction_<%= schedule_day.index %>').typeahead({
        hint: true,
        highlight: true,
        minLength: 1
      },
      {
        name: 'states',
        source: states
      });

  // Sort attraction
  $("#sortable_<%= schedule_day.index %>").sortable();
  $("#sortable_<%= schedule_day.index %>").disableSelection();
  $("#sortable_<%= schedule_day.index %>").sortable({
    update: function (event, ui) {
      var indexes = $('#sortable_<%= schedule_day.index %> #attraction_index')
          .toArray()
          .map(function (ui) {
            return ui.value
          });
      $.ajax({
        method: 'POST',
        data: {'indexes': indexes},
        url: '/schedule_days/<%= schedule_day.id %>/sort.js',
        success: function (data) {
        }
      });
    }
  });
</script>